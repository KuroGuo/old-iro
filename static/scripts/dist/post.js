define(["app","vue","superagent"],function(t,e,n){"use strict";{var o=new e({el:article,data:function(){var t=document.querySelector("#article");return{id:parseFloat(t.dataset.id),likes:parseFloat(t.dataset.likes)||0,unlikes:parseFloat(t.dataset.unlikes)||0}},methods:{like:function(){var t=this;n.post("/p/like",{id:t.id},function(e,n){if((e||200!==n.status)&&(t.likes--,e))throw e}),t.likes++},unlike:function(){var t=this;n.post("/p/unlike",{id:t.id},function(t,e){if((t||200!==e.status)&&(this.unlikes--,t))throw t}),t.unlikes++}}}),i=new e({el:"#comments",data:{comments:[],commentsInfo:{},currentPage:0,pagerMode:"simple"},computed:{simplePageButtons:function(){var t=[],e=Math.max(this.currentPage-2,1),n=e+4;e>1&&t.push({text:"首",value:1});for(var o=e;n>=o;o++)if(!(1>o)){if(o>this.commentsInfo.pages)break;t.push({text:o,value:o})}return n<this.commentsInfo.pages&&t.push({text:"尾",value:this.commentsInfo.pages}),t},fullPageButtons:function(){for(var t=[],e=1;e<=this.commentsInfo.pages;e++)t.push({text:e,value:e});return t}},events:{"hook:created":function(){var t=this;t.loadCommentsInfo(function(){t.commentsInfo.pages>0&&t.loadComments()})}},methods:{loadCommentsInfo:function(t){var e=this;n.get("/p/comments/"+o.id,function(n,o){if(n)throw n;e.commentsInfo=o.body,"function"==typeof t&&t()})},loadComments:function(t,e){var i=this;t=t||1,n.get("/p/comments/"+o.id+"/"+t,function(n,o){if(n)throw n;i.comments=o.body,i.currentPage=t,"function"==typeof e&&e()})},gotoPage:function(t,e){var n=this;"function"==typeof t&&(e=t,t=null),n.loadComments(t,function(){window.scrollBy(0,n.$el.getBoundingClientRect().top),"function"==typeof e&&e()}),n.loadCommentsInfo()},togglePagerMode:function(){this.pagerMode="simple"===this.pagerMode?"full":"simple"}}});new e({el:"#form_comment_wrapper",data:{content:"",sending:!1},methods:{sync:function(t){this.content=t.target.innerHTML},send:function(t){var e=this,o=t.target,s=this.$el.querySelector(".textarea-content"),a={content:s.innerHTML};return a.content?(n.post(o.action,{id:e.id,content:e.content},function(t,n){if(t||200!==n.status){if(e.sending=!1,t)throw t}else i.gotoPage(function(){e.sending=!1,s.innerHTML=e.content=""})}),t.preventDefault(),void(e.sending=!0)):void t.preventDefault()}}})}});